import { Callout } from 'nextra/components'

# Next.js Integration

This guide explains how to integrate FileZen with Next.js applications using the App Router. We recommend using our dedicated SDK packages for the best experience.

> üìÅ **Code Example**: View the complete working example at [github.com/FileZen/filezen/tree/main/apps/nextjs-app-router](https://github.com/FileZen/filezen/tree/main/apps/nextjs-app-router)

## Installation

Install the required FileZen packages for a Next.js project:

```bash filename="Terminal"
# With npm
npm install @filezen/js @filezen/react @filezen/next

# With yarn
yarn add @filezen/js @filezen/react @filezen/next

# With pnpm
pnpm add @filezen/js @filezen/react @filezen/next
```

## Setup

### 1. Environment Variables

Add your FileZen API key to your environment file. The SDK will automatically use this for server-side operations.

```env filename=".env.local"
FILEZEN_API_KEY=your_api_key_here
```

<Callout>
  The FileZen SDK automatically detects the `FILEZEN_API_KEY` environment variable for server-side operations, so no additional configuration is needed in your API routes.
</Callout>

### 2. API Route

Create an API route to handle file uploads and other operations. The `createZenNextRouter` function from `@filezen/next` simplifies this process by creating the necessary `POST` and `DELETE` handlers.

<Callout>
  By default, the client expects this route at `/api/upload`. You should create this file at `app/api/upload/route.ts`. If you wish to use a different path, you can create the route file elsewhere and specify the new path in the `ZenClientProvider`.
</Callout>

```tsx filename="app/api/upload/route.ts"
import { ZenApi } from '@filezen/js';
import { createZenNextRouter } from '@filezen/next';

// The ZenApi class will automatically pick up the FILEZEN_API_KEY from environment variables.
const zenApi = new ZenApi();

export const { POST, DELETE } = createZenNextRouter(zenApi);
```

<Callout>
  The API route is crucial for security, as it keeps your API key on the server and prevents it from being exposed in the client-side code.
</Callout>

### 3. Provider Setup

Wrap your application's root layout with the `ZenClientProvider`. This makes the `ZenClient` instance available to all components in your application via the `useZenClient` hook.

When using `@filezen/next`, you do not need to pass any props to the provider if you use the default API route path (`/api/upload`).

```tsx filename="app/layout.tsx"
import { ZenClientProvider } from '@filezen/react';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <ZenClientProvider>{children}</ZenClientProvider>
      </body>
    </html>
  );
}
```

If you have customized the API route path, you must provide the `signUrl` prop to the `ZenClientProvider`.

```tsx filename="app/layout.tsx"
import { ZenClientProvider } from '@filezen/react';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <ZenClientProvider signUrl="/api/your-custom-path">{children}</ZenClientProvider>
      </body>
    </html>
  );
}
```

## Usage

### File Upload Component

With the provider and API route set up, you can now create a client component to handle file uploads. The `useZenClient` hook provides a `zenClient` instance that communicates with your API route.

```tsx filename="components/FileUpload.tsx"
'use client';

import { ZenFile } from '@filezen/js';
import { useZenClient } from '@filezen/react';
import React from 'react';
import { useDropzone } from 'react-dropzone';

export const FileUpload = () => {
  const zenClient = useZenClient();
  const [isUploading, setIsUploading] = React.useState(false);
  const [uploadResult, setUploadResult] = React.useState<ZenFile | null>(null);

  const handleUpload = async (file: File) => {
    setIsUploading(true);
    const result = await zenClient.upload(file);
    setIsUploading(false);

    if (result.file) {
      setUploadResult(result.file);
    } else {
      console.error(result.error);
    }
  };

  const onDrop = React.useCallback((acceptedFiles: File[]) => {
    if (acceptedFiles.length > 0) {
      handleUpload(acceptedFiles[0]);
    }
  }, []);

  const { getRootProps, getInputProps } = useDropzone({ onDrop });

  return (
    <div>
      <div {...getRootProps()} style={{ border: '2px dashed #ccc', padding: '20px', cursor: 'pointer' }}>
        <input {...getInputProps()} />
        <p>Drag 'n' drop some files here, or click to select files</p>
      </div>
      {isUploading && <p>Uploading...</p>}
      {uploadResult && (
        <div>
          <p>File uploaded successfully!</p>
          <a href={uploadResult.url} target="_blank" rel="noopener noreferrer">
            <img src={uploadResult.url} alt="Upload preview" style={{ maxWidth: '200px' }} />
          </a>
        </div>
      )}
    </div>
  );
};
```
The `zenClient.upload()` method will automatically send the file to your API route (`/api/upload`), which then securely handles the upload to FileZen.











 